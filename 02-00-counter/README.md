# ðŸ“¦ eBPF Packet Counter Example with XDP

This example demonstrates a simple eBPF program written in C and loaded using Go with the [`cilium/ebpf`](https://github.com/cilium/ebpf) library.
It attaches to a network interface via `XDP` and counts the number of incoming packets.

## âœ¨ What It Does

- Attaches an eBPF program to an interface (e.g. `eth0`) at the **XDP hook**.
- The eBPF program counts packets by incrementing a map counter.
- A Go program fetches and logs the count every second.

## ðŸ“¦ What Youâ€™ll See

![demo.gif](assets/demo.gif)
*created with [vhs](https://github.com/charmbracelet/vhs) by Charm CLI*

Every time a packet is sent (e.g., via `ping` command), a log line like the following appears:

```shell
2025/06/24 10:34:27 Counting incoming packets on eth0...
2025/06/24 10:34:28 Received 1 packets
2025/06/24 10:34:29 Received 2 packets
2025/06/24 10:34:30 Received 3 packets
2025/06/24 10:34:31 Exiting...
```

---
## ðŸš€ How to Run

### 1. Install Prerequisites

Please see the instructions in the main [README](./../README.md)

### 2. Generate eBPF bindings

```bash
go generate
```

This uses `bpf2go` to compile the eBPF C code [`counter.c`](./counter.c) and generate Go bindings.

This uses bpf2go to compile counter.c and create:
- `counter_bpfel.o` â€“ the compiled eBPF object file
- `counter_bpfel.go` â€“ auto-generated Go bindings

### 3. Build and Run

```shell
sudo go run .
```

You'll need `sudo` to attach to XDP and access eBPF maps.

You should see logs like:
```shell
Counting incoming packets on eth0...
Received 5 packets
Received 11 packets
```

## ðŸ“‚ File Structure
```shell
.
â”œâ”€â”€ main.go               # Go loader and reporter
â”œâ”€â”€ counter.c             # eBPF XDP program
â”œâ”€â”€ counter_bpfel.go      # Auto-generated by bpf2go
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
```

## ðŸ”’ Permissions
Requires root (`sudo`) to:
* Load eBPF programs into the kernel
