# ğŸ“ eBPF Tracepoint Example: Trace File Open Events

This example demonstrates how to write an eBPF program in C and load it using Go and the cilium/ebpf library. The 
program attaches to the `sys_enter_openat` tracepoint and logs a message every time a file is opened on the system.

## ğŸ“¦ What Youâ€™ll See

![demo.gif](demo.gif)
*created with [vhs](https://github.com/charmbracelet/vhs) by Charm CLI*

Every time a file is opened (e.g., via cat /etc/hosts), a log line like the following appears:

```shell
bpf_trace_printk: File opening...
```

## ğŸš€ How to Run

### 1. Install Prerequisites

Please see the instructions in the main [README](./../README.md)

### 2. Generate Go Bindings

```shell
go generate
```

This runs `bpf2go` to compile [`openfile.c`](./openfile.c) and generate Go bindings.

### 3. Run the Program
```
sudo go run main.go
```

Youâ€™ll see something like:
```shell
eBPF program attached. Waiting for events...
Reading trace_pipe output...
```

### 4. Trigger File Opens

Open a new terminal and run:
```shell
cat /etc/hosts
ls /tmp
```

Youâ€™ll see logs from the eBPF program printed in your terminal.

### 5. Exit
Use `Ctrl+C` to exit the program gracefully.

## ğŸ“‚ File Structure

```shell
.
â”œâ”€â”€ main.go            # Loads and attaches the eBPF program
â”œâ”€â”€ openfile.c         # eBPF program in C (uses bpf_trace_printk)
â”œâ”€â”€ openfile_bpfel.go  # Auto-generated by bpf2go
â”œâ”€â”€ openfile_bpfeb.go  # Auto-generated by bpf2go
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
```

## ğŸ”’ Permissions
Requires root (`sudo`) to:
* Load eBPF programs into the kernel
* Read /sys/kernel/debug/tracing/trace_pipe
