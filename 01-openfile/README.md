# 📁 eBPF Tracepoint Example: Trace File Open Events

This example demonstrates how to write an eBPF program in C and load it using Go and the cilium/ebpf library. The 
program attaches to the `sys_enter_openat` tracepoint and logs a message every time a file is opened on the system.

## 📦 What You’ll See

![demo.gif](demo.gif)
*created with [vhs](https://github.com/charmbracelet/vhs) by Charm CLI*

Every time a file is opened (e.g., via cat /etc/hosts), a log line like the following appears:

```shell
bpf_trace_printk: File opening...
```

## 🚀 How to Run

### 1. Install Prerequisites

Please see the instructions in the main [README](./../README.md)

### 2. Generate Go Bindings

```shell
go generate
```

This runs `bpf2go` to compile [`openfile.c`](./openfile.c) and generate Go bindings.

### 3. Run the Program
```
sudo go run main.go
```

You’ll see something like:
```shell
eBPF program attached. Waiting for events...
Reading trace_pipe output...
```

### 4. Trigger File Opens

Open a new terminal and run:
```shell
cat /etc/hosts
ls /tmp
```

You’ll see logs from the eBPF program printed in your terminal.

### 5. Exit
Use `Ctrl+C` to exit the program gracefully.

## 📂 File Structure

```shell
.
├── main.go            # Loads and attaches the eBPF program
├── openfile.c         # eBPF program in C (uses bpf_trace_printk)
├── openfile_bpfel.go  # Auto-generated by bpf2go
├── openfile_bpfeb.go  # Auto-generated by bpf2go
├── go.mod
├── go.sum
```

## 🔒 Permissions
Requires root (`sudo`) to:
* Load eBPF programs into the kernel
* Read /sys/kernel/debug/tracing/trace_pipe
